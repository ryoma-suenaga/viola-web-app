<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIOLA | ams OSRAM Controller</title>
    <style>
        :root { --accent: #ff5e00; --bg: #050505; --card: #141414; --text: #ffffff; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding-bottom: 50px; }
        .header { width: 100%; padding: 40px 0; text-align: center; background: linear-gradient(180deg, #111 0%, transparent 100%); }
        .logo-img { width: 240px; height: auto; margin-bottom: 10px; filter: drop-shadow(0 0 15px rgba(255,94,0,0.3)); }
        h1 { margin: 0; font-size: 1rem; letter-spacing: 5px; font-weight: 300; color: #777; text-transform: uppercase; }
        #matrix-shell { background: #000; padding: 20px; border-radius: 20px; border: 1px solid #222; box-shadow: 0 10px 40px rgba(0,0,0,1); margin: 20px 0; }
        #matrix { display: grid; grid-template-columns: repeat(8, 32px); gap: 6px; }
        .led { width: 32px; height: 32px; background: #111; border-radius: 4px; position: relative; transition: background 0.05s linear; }
        .led::after { content: ''; position: absolute; inset: 0; border-radius: 4px; filter: blur(5px); opacity: 0.8; background: inherit; }
        .container { width: 90%; max-width: 400px; display: flex; flex-direction: column; gap: 15px; }
        .card { background: var(--card); border-radius: 16px; padding: 20px; border: 1px solid #222; }
        .label { font-size: 0.7rem; color: #555; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 12px; display: block; font-weight: bold; }
        button { background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 14px; border-radius: 10px; cursor: pointer; transition: 0.2s; font-size: 0.85rem; }
        button:active { background: var(--accent); color: #000; transform: scale(0.98); }
        .btn-primary { background: var(--accent); color: #fff; border: none; font-weight: bold; width: 100%; box-shadow: 0 4px 15px rgba(255,94,0,0.2); }
        input[type="range"] { width: 100%; accent-color: var(--accent); margin: 10px 0; }
        input[type="color"] { width: 100%; height: 50px; border: none; border-radius: 8px; background: none; cursor: pointer; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <img src="Logo.png" alt="ams OSRAM" class="logo-img">
        <h1>Viola Ecosystem</h1>
    </div>
    <div id="matrix-shell"><div id="matrix"></div></div>
    <div class="container">
        <button class="btn-primary" onclick="connect()">INITIALIZE SYSTEM</button>
        <div class="card"><span class="label">Atmospheric Color</span><input type="color" value="#ff5e00" oninput="setStatic(this.value)"></div>
        <div class="card"><span class="label">Intensity (GCC)</span><input type="range" min="0" max="255" value="128" oninput="updateGCC(this.value)"></div>
        <div class="card"><span class="label">Advanced Modes (Math-based)</span>
            <div class="grid-2">
                <button onclick="runMode('phoenix')">PHOENIX</button>
                <button onclick="runMode('ocean')">OCEAN</button>
                <button onclick="runMode('plasma')">PLASMA</button>
                <button onclick="runMode('off')" style="color: #ff4444;">OFF</button>
            </div>
        </div>
    </div>

    <script>
        // --- Simplified Noise Function for Organic Movement ---
        const noise=(()=>{let p=new Uint8Array(512),perm=new Uint8Array(512),gradP=new Float32Array(512);for(let i=0;i<256;i++)p[i]=i;for(let i=0;i<256;i++){let r=i+Math.random()*(256-i)|0,t=p[i];p[i]=p[r],p[r]=t}for(let i=0;i<512;i++){perm[i]=p[i&255],gradP[i]=Math.random()*2-1}let lerp=(t,a,b)=>a+t*(b-a),fade=t=>t*t*t*(t*(t*6-15)+10);return(x,y,z)=>{let X=Math.floor(x)&255,Y=Math.floor(y)&255,Z=Math.floor(z)&255;x-=Math.floor(x),y-=Math.floor(y),z-=Math.floor(z);let u=fade(x),v=fade(y),w=fade(z),A=perm[X]+Y,AA=perm[A]+Z,AB=perm[A+1]+Z,B=perm[X+1]+Y,BA=perm[B]+Z,BB=perm[B+1]+Z;return lerp(w,lerp(v,lerp(u,gradP[AA]*x+gradP[AA+1]*(x-1)),lerp(u,gradP[AB]*x+gradP[AB+1]*(x-1))),lerp(v,lerp(u,gradP[BA]*x+gradP[BA+1]*(x-1)),lerp(u,gradP[BB]*x+gradP[BB+1]*(x-1))))}})();

        const matrixEl = document.getElementById('matrix');
        const leds = [];
        let gcc = 0.5;
        let interval = null;
        let t = 0;

        function initMatrix() {
            matrixEl.innerHTML = '';
            for (let i = 0; i < 64; i++) {
                const led = document.createElement('div');
                led.className = 'led';
                matrixEl.appendChild(led);
                leds.push(led);
            }
        }

        function draw(x, y, r, g, b) {
            const index = y * 8 + x;
            if (leds[index]) {
                // Clamp values to 0-255 before applying brightness
                r = Math.max(0, Math.min(255, r));
                g = Math.max(0, Math.min(255, g));
                b = Math.max(0, Math.min(255, b));
                leds[index].style.background = `rgb(${r*gcc},${g*gcc},${b*gcc})`;
            }
        }

        function setStatic(hex) {
            stop();
            const r = parseInt(hex.slice(1,3), 16), g = parseInt(hex.slice(3,5), 16), b = parseInt(hex.slice(5,7), 16);
            for(let i=0; i<64; i++) draw(i%8, Math.floor(i/8), r, g, b);
        }

        function runMode(mode) {
            stop();
            if (mode === 'off') { leds.forEach(l => l.style.background = '#080808'); return; }
            interval = setInterval(() => {
                t += 0.015; // Slower time base for smoother changes
                for(let y=0; y<8; y++) {
                    for(let x=0; x<8; x++) {
                        if (mode === 'phoenix') {
                            // Fire with upward scrolling noise
                            // y coord is offset by time 't' to create rising effect
                            let n = noise(x * 0.3, y * 0.2 + t * 3, t); // 3D noise for organic movement
                            let heat = (n * 0.5 + 0.5) * 255; // Map noise -1~1 to 0~255
                            // Apply vertical gradient (hotter at bottom)
                            heat = heat * (1 - (y / 10.0)); 
                            // Fire palette mapping
                            draw(x, y, heat, heat*heat/200, heat*heat*heat/8000);

                        } else if (mode === 'ocean') {
                            // Water ripples with noise-distorted phase
                            let n = noise(x * 0.2 + t, y * 0.2, t * 0.5);
                            // Sine wave with noise added to input
                            let wave = Math.sin(x * 0.5 + y * 0.3 + t * 2 + n * 2); 
                            let brightness = (wave * 0.5 + 0.5) * 200 + 55;
                            draw(x, y, 0, brightness * 0.6, brightness);

                        } else if (mode === 'plasma') {
                            // Slowly changing random colors using noise on RGB channels
                            // Different time scales for each channel creates complex shifting
                            let r = (noise(x*0.1, y*0.1, t*0.7) * 0.5 + 0.5) * 255;
                            let g = (noise(x*0.15, y*0.15, t*0.5 + 10) * 0.5 + 0.5) * 255;
                            let b = (noise(x*0.2, y*0.2, t*0.3 + 20) * 0.5 + 0.5) * 255;
                            draw(x, y, r, g, b);
                        }
                    }
                }
            }, 30); // Faster update rate for smoother animation
        }

        function updateGCC(v) { gcc = v / 255; }
        function stop() { if(interval) clearInterval(interval); interval = null; }
        function connect() { alert("Simulating BLE connection to VIOLA..."); }
        window.onload = initMatrix;
    </script>
</body>
</html>
