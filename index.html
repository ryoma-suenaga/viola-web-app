<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viola Control Interface</title>
    <style>
        :root { --bg-color: #0f0f0f; --card-bg: #1e1e1e; --accent: #00d4ff; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg-color); color: #e0e0e0; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        h1 { color: var(--accent); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 10px; }
        
        /* 8x8 Matrix Simulator */
        #matrix-container { background: #000; padding: 15px; border-radius: 12px; box-shadow: 0 0 20px rgba(0,0,0,0.5); margin-bottom: 25px; }
        #matrix { display: grid; grid-template-columns: repeat(8, 35px); gap: 5px; }
        .led { width: 35px; height: 35px; background: #1a1a1a; border-radius: 4px; transition: all 0.15s ease; box-shadow: inset 0 0 5px #000; }

        /* Control Panel */
        .panel { width: 100%; max-width: 400px; background: var(--card-bg); padding: 20px; border-radius: 15px; display: flex; flex-direction: column; gap: 20px; }
        .section-title { font-size: 0.9rem; color: #888; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 5px; }
        
        button { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: opacity 0.2s; }
        .btn-connect { background: var(--accent); color: #000; font-size: 1rem; }
        .btn-mode { background: #333; color: white; border: 1px solid #444; }
        .btn-mode:active { background: var(--accent); color: #000; }
        
        input[type="range"] { width: 100%; accent-color: var(--accent); }
        input[type="color"] { width: 100%; height: 60px; border: none; border-radius: 8px; background: none; cursor: pointer; }
        
        .status-bar { font-size: 0.8rem; margin-top: 10px; color: #666; }
    </style>
</head>
<body>

    <h1>VIOLA</h1>
    <p style="margin-top:-10px; margin-bottom: 20px; color: #666;">8x8 RGB Matrix Controller</p>
    
    <div id="matrix-container">
        <div id="matrix"></div>
    </div>

    <div class="panel">
        <button class="btn-connect" onclick="connectBLE()">CONNECT TO VIOLA</button>
        
        <div class="section-title">Static Color Selection</div>
        <input type="color" id="colorPicker" value="#00d4ff" oninput="setStaticColor(this.value)">
        
        <div class="section-title">Global Brightness (GCC)</div>
        <input type="range" min="0" max="255" value="127" oninput="updateBrightness(this.value)">

        <div class="section-title">Animation Modes</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button class="btn-mode" onclick="runDemo('fire')">FLAME</button>
            <button class="btn-mode" onclick="runDemo('wave')">WAVE</button>
            <button class="btn-mode" onclick="runDemo('tetris')">GEOMETRIC</button>
            <button class="btn-mode" style="background: #a00;" onclick="stopAnimation()">STOP</button>
        </div>
    </div>

    <div class="status-bar" id="status">Status: Simulator Mode (Hardware Disconnected)</div>

    <script>
        const matrix = document.getElementById('matrix');
        const leds = [];
        let animId = null;
        let globalBrightness = 0.5;

        // Initialize 8x8 Grid
        for (let i = 0; i < 64; i++) {
            const led = document.createElement('div');
            led.className = 'led';
            matrix.appendChild(led);
            leds.push(led);
        }

        function updateLED(x, y, r, g, b) {
            const index = y * 8 + x;
            if (index >= 0 && index < 64) {
                // Apply brightness scaling to simulator
                const br = globalBrightness;
                leds[index].style.background = `rgb(${r*br},${g*br},${b*br})`;
                leds[index].style.boxShadow = `0 0 15px rgba(${r},${g},${b},${br * 0.6})`;
            }
        }

        function setStaticColor(hex) {
            stopAnimation();
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            for (let y = 0; y < 8; y++) {
                for (let x = 0; x < 8; x++) updateLED(x, y, r, g, b);
            }
        }

        function updateBrightness(val) {
            globalBrightness = val / 255;
            // Refresh current display
            const currentColor = document.getElementById('colorPicker').value;
            if (!animId) setStaticColor(currentColor);
        }

        function runDemo(type) {
            stopAnimation();
            let frame = 0;
            animId = setInterval(() => {
                frame++;
                for (let y = 0; y < 8; y++) {
                    for (let x = 0; x < 8; x++) {
                        if (type === 'fire') {
                            const r = Math.floor(Math.random() * 255);
                            updateLED(x, y, r, r/4, 0);
                        } else if (type === 'wave') {
                            const b = Math.floor(Math.sin(x/2 + frame/5) * 127 + 128);
                            updateLED(x, y, 0, b/2, b);
                        } else if (type === 'tetris') {
                            const val = (x + y + frame) % 8 === 0 ? 255 : 20;
                            updateLED(x, y, val, 0, val);
                        }
                    }
                }
            }, 100);
        }

        function stopAnimation() {
            if (animId) clearInterval(animId);
            animId = null;
        }

        async function connectBLE() {
            document.getElementById('status').innerText = "Status: Searching for Viola...";
            // Web Bluetooth implementation goes here
        }
    </script>
</body>
</html>